description: Consent artifact object
type: object
required:
  - meta 
  - main
  - signatures
properties:
  meta:
    description: Meta attributes of the consent artifact
    type: object
    required:
      - status
      - timestamp
    properties:
      status:
        description: Status of the artifact
        type: string
        example: 'ACTIVE'
        enum:
          - ACTIVE
          - DENIED
          - REVOKED
          - PAUSED
      timestamp:
        description: Timestamp placed by the issuing consent manager, in ISO 8601 format 
        $ref: '../attributes/timestamp.yaml'
  main:
    description: Main attributes of the consent artifact
    type: object
    required:
      - farmerId
      - aipId
      - aiuId
      - purposeCode
      - validUntil
      - attributes
    properties:
      farmerId:
        description: Identifier of the farmer who gave consent (i.e. whose data is intended to be shared)
        type: string
        pattern: '^\d{11}$'
        example: 12341234123
      aipId:
        description: Identifier of the agricultural information provider (AIP) maintaining data 
        type: string
        example: 'AIP1'
      aiuId:
        description: Identifier of the agricultural information user (AIU) intending to fetch data from the AIP
        type: string
        example: 'AIU1'
      purposeCode:
        description: Purpose code indicating the intended purpose of the AIU for fetching data from the AIP 
        type: string
        example: 'CREDIT_KCC'
        enum:
          - CREDIT_KCC
          - CREDIT_OTHER
          - INPUT_SUBSIDY
          - INSURANCE
      validUntil:
        description: Date until which permission to fetch data has been granted
        type: string
        format: date
        example: '2024-03-31'
      attributes:
        description: Set of data attributes that can be fetched against the artifact
        type: object
        properties:
          profileAttributes:
            description: List of profile data attributes that can be fetched
            type: array
            example: '[{"systemName": "NAME", "displayName": "Farmer name"}, 
                       {"systemName": "DOB", "displayName": "Date of birth"} ]'
            items:
              description: Name of the attribute that is permitted to be fetched
              type: object
              required: 
                - systemName
                - displayName
              properties:
                systemName: 
                  type: string
                  enum:
                    - NAME
                    - GENDER
                    - DOB
                    - ADDRESS
                    - CASTE
                displayName: 
                  type: string
                  example: "Farmer name"
          assetAttributes:
            description: List of asset data attributes that can be fetched
            type: array
            example: '[ {"attributeName": {"systemName": "FARM_DATA", "displayName": "Farm ownership data"}, 
                         "auxiliaryData": {"label": "FARM_IDENTIFIERS_LIST", "value": "AjyDii834pjkads_f023+TJf9ujk39fasaASFE39hafdee33"  }} ]'
              #  {"attributeName": {"systemName": "CROP_COUNT", "displayName": "Number of crops"}, 
              #            "seasonName": {"seasonType": {"systemName": "RABI", "displayName", "Rabi"}, "year": "2023"}},
              #          {"attributeName": {"systemName": "CROP_COUNT", "displayName": "Number of crops"}, 
              #            "seasonName": {"seasonType": {"systemName": "KHARIF", "displayName", "Kharif"}, "year": "2022"}},
              #          {"attributeName": {"systemName": "CROP_LIST", "displayName": "List of crops"}, 
              #            "seasonName": {"seasonType": {"systemName": "KHARIF", "displayName", "Kharif"}, "year": "2022"}} ]'
            items:
              type: object 
              description: Object that defines each item in the list of asset data attributes permitted to be fetched
              required:
                - attributeName
                - auxiliaryData
              properties:
                attributeName:
                  description: Name of the attribute that is permitted to be fetched
                  type: object
                  required:
                    - systemName
                    - displayName
                  properties:
                    systemName:
                      type: string
                      enum: 
                        - FARM_DATA
                        - CROP_DATA
                    displayName:
                      type: string
                      example: "Farm ownership data"
                auxiliaryData:
                  description: Auxiliary data e.g., encrypted list of asset identifiers
                  type: object
                  required:
                    - label
                    - value
                  properties:
                    label:
                      description: Label given to the auxiliary data by the CM
                      type: string
                      example: 'FARM_IDENTIFIERS_LIST'
                      enum:
                        - FARM_IDENTIFIERS_LIST
                    value:
                      description: Value of the auxiliary data e.g. Base64-encoded list of encrypted farm 
                        identifiers, as provided to the CM by the relevant AIP 
                      type: string
                      example: 'AjyDii834pjkads_f023+TJf9ujk39fasaASFE39hafdee33'
                        # seasonName:
                        #   description: Name of the season for which the attribute's value is sought
                        #   $ref: '../objects/seasonName.yaml'
  signatures:
    description: Digital signatures on the meta and main attributes of the artifact
    type: object
    required: 
      - cmSignature
    properties:
      cmSignature:
        type: object
        description: Digital signature created by the CM on the meta and main attributes of the artifact
        required:
          - cmId
          - signature
        properties:
          cmId:
            description: ID of the consent manager signing the artifact
            type: string
            example: 'CM-45209311'
          signature:
            description: JWS signature
            type: string
            example: 'kjfd34mdf=KedfnfEpd2dmd+kDf..kfdl89rpK2Bsaf4ypS+ruE1o'
      userSignature:
        type: object
        description: Digital signature created by an E-Sign Service Provider (ESP) on behalf of the user. 
          The signature is created on the hash of the concatenation of the meta and main attributes of 
          the consent artifact
        required:
          - espInfo
          - certificate
          - signature
        properties:
          espInfo:
            description: Details of the ESP that creates the digital signature 
            type: object
            required:
              - espName
            properties:
              espName:
                description: Name of the ESP 
                type: string
                example: ESP1
              espUrl:
                description: URL of the ESP 
                type: string
                example: https://esp1.com/
          certificate: 
            description: Base64-encoded digital certificate of the user on whose behalf the signature is generated
            type: string
            example: 'jRjf93mfDfjoe894kff+4PJi00kjfddf9Riamdf=Kedf..nfEpd2dmd+kDf..dl8df4M39rpKdweijr2Bsaf4ypS+r++re84'
          signature:
            description: Base64-encoded signature
            type: string
            example: 'kjfd34mdf=KedfnfEpd2dmd+kDf..kfdl89rpK2Bsaf4ypS+ruE1o'
